<?xml version="1.0"?>
<project name="jozclientapi-testsuite" default="no-default" basedir="..">
	<property name="test.dir" value="./test"/>
    <!-- NOTE WELL: This file is imported into the main build.xml file.
         It is not intended to work standalone.  -->

  
	<path id="classpath.jozclientapi">
	<pathelement location="${ext.lib.dir}/junit-4.4.jar" />
		<pathelement location="${llc.lib.dir}/lls.jar"/>
    	<pathelement location="${dist.dir}/testsuite.jar" />
    	<pathelement location="${dist.dir}/jozclient.jar" />
    	<pathelement location="${ext.lib.dir}/log4j-1.2.6.jar" />
    	<pathelement location="${dist.dir}/joz.jar" />
    	<pathelement location="${ext.lib.dir}/lucene-core-2.1.0.jar"/>
    	<pathelement location="${caa.lib.dir}/caa.jar"/>
    	<pathelement location="${utils.lib.dir}/utils.jar"/>
    	<pathelement location="${ext.lib.dir}/xstream-1.3.jar" />
    	<pathelement location="${ext.lib.dir}/xpp3_min-1.1.4c.jar" />
    	<pathelement location="${cma.lib.dir}/cma.jar"/>
    	<pathelement location="${test.dir}"/>
	</path>
	
	
    <!-- ****************************************************************** -->

    <target name="compile-tests">

        <javac destdir="${classes.dir}"
               debug="on"
               optimize="on"
               srcdir="${test.dir}"
               includes="com/tumri/joz/client/*.java">
            <classpath refid="project.class.path"/>
            <classpath refid="classpath.jozclientapi"/>
            <compilerarg value="-Xlint:unchecked"/>
	    <compilerarg value="-Xlint:deprecation"/>
        </javac>

    </target>

    <!-- ****************************************************************** -->

    <target name="build-testsuite-jar"
	    depends="init,compile-tests">

        <delete dir="${dist.dir}/testsuite"/>
        <mkdir dir="${dist.dir}/testsuite"/>

        <!-- copy so it gets put into our jar -->
        <copy file="${joz.test.conf.dir}/log4j.properties"
              todir="${dist.dir}/testsuite"/>
    	<copy file="${joz.test.conf.dir}/joz.properties"
    	      todir="${dist.dir}/testsuite"/>
    	<copy file="${joz.test.conf.dir}/lls.properties"
    	      todir="${dist.dir}/testsuite"/>
    	<copy file="${ext.data.dir}/zipcodedb.xml"
    	      todir="${dist.dir}/testsuite"/>

	   <jar destfile="${dist.dir}/testsuite.jar">
            <fileset dir="${classes.dir}"
		     includes="com/tumri/joz/client/*.class"/>
		<fileset dir="${dist.dir}/testsuite" 
			includes="log4j.properties"/>
	   	<fileset dir="${dist.dir}/testsuite" 
	   		includes="joz.properties"/>
	   	<fileset dir="${dist.dir}/testsuite" 
	   		includes="lls.properties"/>
	   	<fileset dir="${dist.dir}/testsuite" 
	   		includes="zipcodedb.xml"/>
            
        </jar>

    </target>

    <!-- ****************************************************************** -->

    <target name="build-tests"
	    depends="build-testsuite-jar"/>

    <!-- ****************************************************************** -->

	<target name="run-tests" depends="build-tests">
        <echo message="Running tests" />
		<java  failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozIndexSetup"/>
		    <classpath refid="classpath.jozclientapi" />    
		</java>

		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozMerchantDataProviderImpl"/>
			<classpath refid="classpath.jozclientapi" />    
		</java>

		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozTaxonomyDataProviderImpl"/>
		    <classpath refid="classpath.jozclientapi" />    
		</java>

		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozAdDataProviderImpl"/>
			<classpath refid="classpath.jozclientapi" />    
		</java>
		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozTSpecProviderImpl"/>
			<classpath refid="classpath.jozclientapi" />    
		</java>
		
		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozCountDataProviderImpl"/>
		    <classpath refid="classpath.jozclientapi" />    
		</java>

		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozCampaignProviderImpl"/>
			<classpath refid="classpath.jozclientapi" />    
		</java>
			
	 </target>

	<target name="run-adptest" depends="build-tests">
		<java failonerror="true"  fork="true" classname="junit.textui.TestRunner" maxmemory="1024m">
			<arg value="com.tumri.joz.client.TestJozAdDataProviderImpl"/>
			<classpath refid="classpath.jozclientapi" />
		</java>
		

	 </target>

</project>
